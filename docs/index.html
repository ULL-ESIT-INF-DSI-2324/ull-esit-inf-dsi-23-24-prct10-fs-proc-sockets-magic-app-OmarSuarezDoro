<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>modi10</title><meta name="description" content="Documentation for modi10"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">modi10</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>modi10</h2></div><div class="tsd-panel tsd-typography"><ul>
<li>Autor: <strong>Omar Suárez Doro</strong> </li>
<li>Email: <strong><a href="mailto:alu0101483474@ull.edu.es">alu0101483474@ull.edu.es</a></strong></li>
<li>Asignatura: <strong>Desarrollo de Sistemas Informáticos</strong></li>
</ul>
<a id="md:índice" class="tsd-anchor"></a><h1><a href="#md:índice">Índice</a></h1><ul>
<li><a href="#md:índice">Índice</a></li>
<li><a href="#md:1--introducción-">1. 📚 Introducción 📚</a></li>
<li><a href="#md:2--trabajo-previo-">2. 🧠 Trabajo previo 🧠</a></li>
<li><a href="#md:3-️-desarrollo-de-la-práctica-️">3. 🖥️ Desarrollo de la práctica 🖥️</a></li>
<li><a href="#md:4-conclusiones">4. Conclusiones</a></li>
<li><a href="#md:5-referencias">5. Referencias</a></li>
</ul>
<a id="md:1-📚-introducción-📚" class="tsd-anchor"></a><h1><a href="#md:1-📚-introducción-📚">1. 📚 Introducción 📚</a></h1><p>Este informe tiene como objetivo la redacción de los pasos seguidos durante el desarrollo de la décima practica de la asignatura <strong>Desarrollo de Sistemas Informáticos</strong>.</p>
<a id="md:2-🧠-trabajo-previo-🧠" class="tsd-anchor"></a><h1><a href="#md:2-🧠-trabajo-previo-🧠">2. 🧠 Trabajo previo 🧠</a></h1><p>Para la realización de esta práctica, en primer lugar se han visualizado los vídeos se ha leido y entendido la documentación de <a href="https://www.npmjs.com/package/yargs">yargs</a>, y por otro lado, <a href="https://www.npmjs.com/package/chalk">chalk</a>. A su vez, se han elaborado los siguientes resumenes acerca de la configuración del repositorio.</p>
<blockquote>
<p>[!Important]</p>
<a id="md:github-actions" class="tsd-anchor"></a><h1><a href="#md:github-actions">GitHub Actions</a></h1><ol>
<li><p>Nos dirigimos a la pestaña <code>actions</code> en el repositorio de GitHub. Si nos centramos en <em>Continuous integration workflows</em>, seleccionamos <a href="https://nodejs.org/en">Node.js</a>.</p>
</li>
<li><p>La estructura del archivo <code>node.js.yml</code> es la siguiente:</p>
</li>
</ol>
<ul>
<li>name: Nombre del flujo de trabajo</li>
<li>Pull y Push: Cada vez que se realice un push o un pull en la rama main, se realizarán los jobs especificados.</li>
<li>jobs: Los trabajos a realizar, un ejemplo sería el siguiente.</li>
</ul>
<pre><code class="language-js"><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Tests</span><br/><span class="hl-0">on</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-0">push</span><span class="hl-1">:</span><br/><span class="hl-1">     </span><span class="hl-0">branches</span><span class="hl-1">: [ </span><span class="hl-2">main</span><span class="hl-1"> ]</span><br/><span class="hl-1">  </span><span class="hl-0">pull_request</span><span class="hl-1">:</span><br/><span class="hl-1">     </span><span class="hl-0">branches</span><span class="hl-1">: [ </span><span class="hl-2">main</span><span class="hl-1"> ]</span><br/><br/><span class="hl-0">jobs</span><span class="hl-1">:</span><br/><span class="hl-1"> </span><span class="hl-0">build</span><span class="hl-1">:</span><br/><span class="hl-1">   </span><span class="hl-2">runs</span><span class="hl-1">-</span><span class="hl-0">on</span><span class="hl-1">: </span><span class="hl-2">ubuntu</span><span class="hl-1">-</span><span class="hl-2">latest</span><span class="hl-1"> # </span><span class="hl-2">Se</span><span class="hl-1"> </span><span class="hl-2">debe</span><span class="hl-1"> </span><span class="hl-2">correr</span><span class="hl-1"> </span><span class="hl-2">en</span><span class="hl-1"> </span><span class="hl-2">la</span><span class="hl-1"> </span><span class="hl-2">última</span><span class="hl-1"> </span><span class="hl-2">versión</span><span class="hl-1"> </span><span class="hl-2">de</span><span class="hl-1"> </span><span class="hl-2">ubuntu</span><span class="hl-1"> </span><span class="hl-2">estable</span><br/><br/><span class="hl-1">   </span><span class="hl-0">strategy</span><span class="hl-1">:</span><br/><span class="hl-1">     </span><span class="hl-0">matrix</span><span class="hl-1">:</span><br/><span class="hl-1">       </span><span class="hl-2">node</span><span class="hl-1">-</span><span class="hl-0">version</span><span class="hl-1">: [16.</span><span class="hl-2">x</span><span class="hl-1">, 18.</span><span class="hl-2">x</span><span class="hl-1">, 19.</span><span class="hl-2">x</span><span class="hl-1">, 20.</span><span class="hl-2">x</span><span class="hl-1">, 21.</span><span class="hl-2">x</span><span class="hl-1">] # </span><span class="hl-2">Se</span><span class="hl-1"> </span><span class="hl-2">ejecuta</span><span class="hl-1"> </span><span class="hl-2">en</span><span class="hl-1"> </span><span class="hl-2">todos</span><span class="hl-1"> </span><span class="hl-2">estornos</span><span class="hl-1">.</span><br/><span class="hl-1">       # </span><span class="hl-2">See</span><span class="hl-1"> </span><span class="hl-2">supported</span><span class="hl-1"> </span><span class="hl-2">Node</span><span class="hl-1">.</span><span class="hl-2">js</span><span class="hl-1"> </span><span class="hl-2">release</span><span class="hl-1"> </span><span class="hl-2">schedule</span><span class="hl-1"> </span><span class="hl-2">at</span><span class="hl-1"> </span><span class="hl-0">https</span><span class="hl-1">:</span><span class="hl-3">//nodejs.org/en/about/releases/</span><br/><br/><span class="hl-1">   </span><span class="hl-0">steps</span><span class="hl-1">: # </span><span class="hl-2">Pasos</span><span class="hl-1"> </span><span class="hl-2">a</span><span class="hl-1"> </span><span class="hl-2">arealizar</span><br/><span class="hl-1">   - </span><span class="hl-0">uses</span><span class="hl-1">: </span><span class="hl-2">actions</span><span class="hl-1">/</span><span class="hl-2">checkout</span><span class="hl-1">@</span><span class="hl-2">v4</span><br/><span class="hl-1">   - </span><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Use</span><span class="hl-1"> </span><span class="hl-2">Node</span><span class="hl-1">.</span><span class="hl-2">js</span><span class="hl-1"> </span><span class="hl-2">$</span><span class="hl-1">{{ </span><span class="hl-2">matrix</span><span class="hl-1">.</span><span class="hl-2">node</span><span class="hl-1">-</span><span class="hl-2">version</span><span class="hl-1"> }}</span><br/><span class="hl-1">     </span><span class="hl-0">uses</span><span class="hl-1">: </span><span class="hl-2">actions</span><span class="hl-1">/</span><span class="hl-2">setup</span><span class="hl-1">-</span><span class="hl-2">node</span><span class="hl-1">@</span><span class="hl-2">v4</span><br/><span class="hl-1">     </span><span class="hl-4">with</span><span class="hl-1">:</span><br/><span class="hl-1">       </span><span class="hl-2">node</span><span class="hl-1">-</span><span class="hl-0">version</span><span class="hl-1">: </span><span class="hl-2">$</span><span class="hl-1">{{ </span><span class="hl-2">matrix</span><span class="hl-1">.</span><span class="hl-2">node</span><span class="hl-1">-</span><span class="hl-2">version</span><span class="hl-1"> }} # </span><span class="hl-2">Configuración</span><span class="hl-1"> </span><span class="hl-2">del</span><span class="hl-1"> </span><span class="hl-2">entorno</span><span class="hl-1">.</span><br/><span class="hl-1">   - </span><span class="hl-0">run</span><span class="hl-1">: </span><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><br/><span class="hl-1">   - </span><span class="hl-0">run</span><span class="hl-1">: </span><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">test</span>
</code><button>Copy</button></pre>
<ol start="3">
<li>Realizar un commit (se habrá creado un fichero para nuestra github action).</li>
<li>Se puede crear un badge (opcional)</li>
</ol>
<a id="md:integración-de-coveralls-en-github-action" class="tsd-anchor"></a><h1><a href="#md:integración-de-coveralls-en-github-action">Integración de Coveralls en GitHub action</a></h1><ol start="5">
<li>Desinstalamos Coveralls <code>npm uninstall coveralls</code>.</li>
<li>Modificación del script coverage</li>
</ol>
<pre><code class="language-json"><span class="hl-5">&quot;coverage&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;nyc npm test &amp;&amp; nyc report --reporter=lcov&quot;</span><span class="hl-1">,</span>
</code><button>Copy</button></pre>
<ol start="7">
<li>Creamos en el directorio <code>.github/workflows</code> un nuevo fichero <code>coveralls.yml</code>.</li>
</ol>
<pre><code class="language-js"><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Coveralls</span><br/><span class="hl-0">on</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-0">push</span><span class="hl-1">:</span><br/><span class="hl-1">     </span><span class="hl-0">branches</span><span class="hl-1">: [ </span><span class="hl-2">main</span><span class="hl-1"> ]</span><br/><span class="hl-1">  </span><span class="hl-0">pull</span><span class="hl-1">:</span><br/><span class="hl-1">     </span><span class="hl-0">branches</span><span class="hl-1">: [ </span><span class="hl-2">main</span><span class="hl-1"> ]</span><br/><br/><span class="hl-0">jobs</span><span class="hl-1">:</span><br/><span class="hl-1"> </span><span class="hl-0">build</span><span class="hl-1">:</span><br/><br/><span class="hl-1">   </span><span class="hl-2">runs</span><span class="hl-1">-</span><span class="hl-0">on</span><span class="hl-1">: </span><span class="hl-2">ubuntu</span><span class="hl-1">-</span><span class="hl-2">latest</span><br/><br/><span class="hl-1">   </span><span class="hl-0">steps</span><span class="hl-1">:</span><br/><span class="hl-1">   - </span><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Cloning</span><span class="hl-1"> </span><span class="hl-2">repo</span><br/><span class="hl-1">     </span><span class="hl-0">uses</span><span class="hl-1">: </span><span class="hl-2">actions</span><span class="hl-1">/</span><span class="hl-2">checkout</span><span class="hl-1">@</span><span class="hl-2">v4</span><br/><span class="hl-1">   - </span><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Use</span><span class="hl-1"> </span><span class="hl-2">Node</span><span class="hl-1">.</span><span class="hl-2">js</span><span class="hl-1"> 21.</span><span class="hl-2">x</span><br/><span class="hl-1">     </span><span class="hl-0">uses</span><span class="hl-1">: </span><span class="hl-2">actions</span><span class="hl-1">/</span><span class="hl-2">setup</span><span class="hl-1">-</span><span class="hl-2">node</span><span class="hl-1">@</span><span class="hl-2">v4</span><br/><span class="hl-1">     </span><span class="hl-4">with</span><span class="hl-1">:</span><br/><span class="hl-1">       </span><span class="hl-2">node</span><span class="hl-1">-</span><span class="hl-0">version</span><span class="hl-1">: 21.</span><span class="hl-2">x</span><br/><span class="hl-1">   - </span><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Installing</span><span class="hl-1"> </span><span class="hl-2">dependencies</span><br/><span class="hl-1">     </span><span class="hl-0">run</span><span class="hl-1">: </span><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><br/><span class="hl-1">   - </span><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Generating</span><span class="hl-1"> </span><span class="hl-2">coverage</span><span class="hl-1"> </span><span class="hl-2">information</span><br/><span class="hl-1">     </span><span class="hl-0">run</span><span class="hl-1">: </span><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">coverage</span><br/><span class="hl-1">   - </span><span class="hl-0">name</span><span class="hl-1">: </span><span class="hl-2">Coveralls</span><span class="hl-1"> </span><span class="hl-2">GitHub</span><span class="hl-1"> </span><span class="hl-2">Action</span><br/><span class="hl-1">     </span><span class="hl-0">uses</span><span class="hl-1">: </span><span class="hl-2">coverallsapp</span><span class="hl-1">/</span><span class="hl-2">github</span><span class="hl-1">-</span><span class="hl-2">action</span><span class="hl-1">@</span><span class="hl-2">v2</span><span class="hl-1">.</span><span class="hl-6">2.3</span><br/><span class="hl-1">     </span><span class="hl-4">with</span><span class="hl-1">:</span><br/><span class="hl-1">       </span><span class="hl-2">github</span><span class="hl-1">-</span><span class="hl-0">token</span><span class="hl-1">: </span><span class="hl-2">$</span><span class="hl-1">{{ </span><span class="hl-2">secrets</span><span class="hl-1">.</span><span class="hl-7">GITHUB_TOKEN</span><span class="hl-1"> }}</span>
</code><button>Copy</button></pre>
<a id="md:integración-de-sonarcloud-en-github-action" class="tsd-anchor"></a><h1><a href="#md:integración-de-sonarcloud-en-github-action">Integración de SonarCloud en GitHub action</a></h1><ol start="8">
<li>Inicio de sesión en la web de <a href="https://sonarcloud.io">SonarCloud</a></li>
<li>Se añade el repositorio en cuestión.</li>
<li>Nos dirigimos a la pestaña de <code>Administration &gt; Analysis Method</code> y desactivamos el análisis automático.</li>
<li>En esa misma pestaña, en el apartado <code>with Github Actions</code> hacemos click y copiamos el token.</li>
<li>En Github en la configuración del repositorio, concretamente en el apartado <code>Secrets and variables</code>, añadimos un nuevo secreto con la información obtenida.</li>
<li>En la misma página que estábamos seleccionamos la opción de JS en el siguiente paso y copiamos el contenido que se proporciona para la action.</li>
</ol>
</blockquote>
<a id="md:3-🖥️-desarrollo-de-la-práctica-🖥️" class="tsd-anchor"></a><h1><a href="#md:3-🖥️-desarrollo-de-la-práctica-🖥️">3. 🖥️ Desarrollo de la práctica 🖥️</a></h1><p>En esta práctica se propone implementar una aplicación cliente / servidor que gestione colecciones de cartas de Magic. Para la realización de esta
práctica, se ha tenido que reacondiciona la solución propuesta para la práctica anterior, pues se realizaba el manejo de cartas en memoria, y luego se transmitían los cambios al sistema de archivos, para todo esto en primer lugar se inicializaba una aplicación con el usuario que se vaya a utilizar para la gestión.</p>
<p>En primer lugar se va a analizar la parte del servidor. Para empezar, se creó una clase para poder emitir el evento personalizado <code>request</code> solicitado por parte del servidor:</p>
<pre><code class="language-ts"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-8">class</span><span class="hl-1"> </span><span class="hl-9">CustomServer</span><span class="hl-1"> </span><span class="hl-8">extends</span><span class="hl-1"> </span><span class="hl-9">EventEmitter</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">private</span><span class="hl-1"> </span><span class="hl-2">server_</span><span class="hl-1">: </span><span class="hl-9">net</span><span class="hl-1">.</span><span class="hl-9">Server</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-8">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-8">super</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-8">this</span><span class="hl-1">.</span><span class="hl-2">server_</span><span class="hl-1"> = </span><span class="hl-2">net</span><span class="hl-1">.</span><span class="hl-10">createServer</span><span class="hl-1">((</span><span class="hl-2">socket</span><span class="hl-1">: </span><span class="hl-9">net</span><span class="hl-1">.</span><span class="hl-9">Socket</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-5">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">on</span><span class="hl-1">(</span><span class="hl-5">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">dataChunk</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">wholeData</span><span class="hl-1"> += </span><span class="hl-2">dataChunk</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">indexOf</span><span class="hl-1">(</span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">while</span><span class="hl-1"> (</span><span class="hl-2">messageLimit</span><span class="hl-1"> !== -</span><span class="hl-6">1</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-7">message</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">substring</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-2">messageLimit</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">substring</span><span class="hl-1">(</span><span class="hl-2">messageLimit</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-8">this</span><span class="hl-1">.</span><span class="hl-10">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;request&#39;</span><span class="hl-1">, </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">), </span><span class="hl-2">socket</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">indexOf</span><span class="hl-1">(</span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-10">start</span><span class="hl-1">(</span><span class="hl-2">kPort</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1"> = </span><span class="hl-6">3000</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-8">this</span><span class="hl-1">.</span><span class="hl-2">server_</span><span class="hl-1">.</span><span class="hl-10">listen</span><span class="hl-1">(</span><span class="hl-2">kPort</span><span class="hl-1">, () </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Server listening on port &#39;</span><span class="hl-1"> + </span><span class="hl-2">kPort</span><span class="hl-1">);</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-8">static</span><span class="hl-1"> </span><span class="hl-10">parseCard</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">: </span><span class="hl-9">any</span><span class="hl-1">): </span><span class="hl-9">Card</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">generator</span><span class="hl-1">: </span><span class="hl-9">CardCreator</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">switch</span><span class="hl-1"> (</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;creature&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-10">CreatureCardCreator</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">id_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">name_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">mana_cost_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">color_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">COLOR</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">TYPE</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">rarity_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">RARITY</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">rules_text_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">market_value_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">power_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">toughness_</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;planeswalker&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-10">PlanesWalkerCardCreator</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">id_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">name_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">mana_cost_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">color_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">COLOR</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">TYPE</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">rarity_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">RARITY</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">rules_text_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">market_value_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">loyalty_marks_</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">default</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-10">CardCreator</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">id_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">name_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">mana_cost_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">color_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">rarity_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">rules_text_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">market_value_</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-2">generator</span><span class="hl-1">.</span><span class="hl-10">createCard</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Como se puede apreciar, el constructor tiene como objetivo principal manerar el evento data, para poder emitir el evento personalizado si fuese necesario. A continuación, se puede apreciar un método <code>Start</code>, cuyo objetivo principal es el inicio del servidor. Finalmente apreciamos un método parsecard, que tiene como objetivo facilitar las expresiones para la construcción de objetos. Para poder conseguirlo, se ha empleado un patrón de factoryMethod implementado para la práctica anterior.</p>
<p>Si analizamos ahora el código que permite llevar a cabo toda la funcionalidad, es el correspondiente al manejador del evento <code>request</code>:</p>
<pre><code class="language-ts"><span class="hl-2">server</span><span class="hl-1">.</span><span class="hl-10">on</span><span class="hl-1">(</span><span class="hl-5">&#39;request&#39;</span><span class="hl-1">, (</span><span class="hl-2">data</span><span class="hl-1">: </span><span class="hl-9">requestMessage</span><span class="hl-1">, </span><span class="hl-2">socket</span><span class="hl-1">: </span><span class="hl-9">net</span><span class="hl-1">.</span><span class="hl-9">Socket</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">stat</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The user does not exist!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-4">switch</span><span class="hl-1"> (</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">action</span><span class="hl-1">) {</span><br/><span class="hl-1">   </span><span class="hl-3">// Implementación de la funcionalidad</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Como se puede apreciar, se recibe la petición, y lo primero es comprobar si el usuario existe, en caso de que no existe, se finaliza la conexión. A continuación podemos observar que se comienza el switch que dependerá del valor de la propiedad action (que actuará como comando). Aclarar que en cada funcionalidad se comprueba mediante el método <code>stat</code> si el archivo existe o no.</p>
<p>A continuación vamos a analizar el código de cada funcionalidad:</p>
<ul>
<li>Funcionalidad de añadir:</li>
</ul>
<pre><code class="language-ts"><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Add action&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">card</span><span class="hl-1">: </span><span class="hl-9">Card</span><span class="hl-1"> = </span><span class="hl-2">CustomServer</span><span class="hl-1">.</span><span class="hl-10">parseCard</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">stat</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">card</span><span class="hl-12">.</span><span class="hl-2">id</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">writeFile</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">card</span><span class="hl-12">.</span><span class="hl-2">id</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">, </span><span class="hl-8">null</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">), (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">error</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;Error while writing the file&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">            } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">201</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file was saved successfully!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">          </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file already exists!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-4">break</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>Lo recalcable en este fragmento de código es la sustitución de los métodos asíncronos de la anterior práctica, por los métodos asíncronos. Esto obliga al uso de <code>socket.end()</code> en varios puntos del código.</p>
<ul>
<li>Funcionalidad borrado:</li>
</ul>
<pre><code class="language-ts"><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Delete action&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">dataObj</span><span class="hl-12">.</span><span class="hl-2">id_</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">stat</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">dataObj</span><span class="hl-12">.</span><span class="hl-2">id_</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file does not exist!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">          </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">unlink</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">dataObj</span><span class="hl-12">.</span><span class="hl-2">id_</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;Error while deleting the file&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">            } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">201</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file was deleted successfully!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-3">// socket.write(JSON.stringify({ statusCode: 0 }) + &#39;\n&#39;);</span><br/><span class="hl-1">      });</span><br/><br/><span class="hl-1">      </span><span class="hl-4">break</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>Esta funcionalidad sigue la misma lógica que la anterior, lo único que se ha empleado el método <code>unlink</code>.</p>
<ul>
<li>Funcionalidad modificar</li>
</ul>
<pre><code class="language-ts"><span class="hl-1"> </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Update action&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">stat</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">path</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file does not exist!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">          </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">readFile</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">path</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, </span><span class="hl-5">&#39;utf8&#39;</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">readData</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">error</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;Error while reading the file&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">              </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">readObj</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">readData</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">key</span><span class="hl-1"> </span><span class="hl-8">in</span><span class="hl-1"> </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-2">readObj</span><span class="hl-1">[</span><span class="hl-2">key</span><span class="hl-1">] = </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">[</span><span class="hl-2">key</span><span class="hl-1">];</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-2">readObj</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">writeFile</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">path</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">(</span><span class="hl-2">readObj</span><span class="hl-1">, </span><span class="hl-8">null</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">), (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">error</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">4</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;Error while writing the file&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">              } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">201</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file was updated successfully!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-4">break</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>Esta funcionalidad resulta ser un poco más compleja, pues se realiza:</p>
<ol>
<li>Se comprueba si el archivo exista.</li>
<li>Se lee el contenido del archivo</li>
<li>Se itera por el objeto recibido a través del mensaje (dataObj), y se modifican las cualidades del objeto leido</li>
<li>Se escribe el contenido del archivo</li>
</ol>
<ul>
<li>Funcionalidad listar cartas</li>
</ul>
<pre><code class="language-ts"><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">readdir</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">files</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">error</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">files</span><span class="hl-1">.</span><span class="hl-10">forEach</span><span class="hl-1">(</span><span class="hl-2">file</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">readFile</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">file</span><span class="hl-8">}</span><span class="hl-5">`</span><span class="hl-1">, </span><span class="hl-5">&#39;utf8&#39;</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">error</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1">);</span><br/><span class="hl-1">              } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">parsedCard</span><span class="hl-1">: </span><span class="hl-9">Card</span><span class="hl-1"> = </span><span class="hl-2">CustomServer</span><span class="hl-1">.</span><span class="hl-10">parseCard</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">));</span><br/><span class="hl-1">                </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">200</span><span class="hl-1">, </span><span class="hl-2">user:</span><span class="hl-1"> </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">).</span><span class="hl-2">user</span><span class="hl-1">, </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-2">parsedCard</span><span class="hl-1">.</span><span class="hl-2">type</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-2">parsedCard</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-3">// socket.end();</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">0</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-4">break</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>Esta funcionalidad cambia un poco. Como se puede apreciar se leen el contenido de los ficheros del directorio, y se emiten mensajes con la información de cada carta. En un primer momento, se pensó en enviar un array con todas las cartas, sin embargo, por como funciona el bucle de eventos de node, junto a la pila de llamadas, sucedía el caso de que se enviaba dicha estructura de datos vacía. Por otro lado, se pretendía acabar la conexión por parte del cliente haciendo uso de  <code>socket.end()</code>, sin embargo en ese caso solo enviaría la información de una carta. Por lo que debido a estas dificultades, se ha decidido enviar un statusCode de 0 en el mensaje para indicar al cliente el fin de la conexión. Esto no satisface el requisito que se exigía respecto al cierre de la conexión por parte del cliente, pero no he encontrado otra forma.
list</p>
<ul>
<li>Funcionalidad de listar una carta en específica</li>
</ul>
<pre><code class="language-ts"><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;list-unique&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">stat</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">dataObj</span><span class="hl-12">.</span><span class="hl-2">id</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file does not exist!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">          </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">readFile</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">dataObj</span><span class="hl-12">.</span><span class="hl-2">id</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, </span><span class="hl-5">&#39;utf8&#39;</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">error</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;Error while reading the file&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">              </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">parsedCard</span><span class="hl-1">: </span><span class="hl-9">Card</span><span class="hl-1"> = </span><span class="hl-2">CustomServer</span><span class="hl-1">.</span><span class="hl-10">parseCard</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">));</span><br/><span class="hl-1">            </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">200</span><span class="hl-1">, </span><span class="hl-2">user:</span><span class="hl-1"> </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">).</span><span class="hl-2">user</span><span class="hl-1">, </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-2">parsedCard</span><span class="hl-1">.</span><span class="hl-2">type</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-2">parsedCard</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-4">break</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>Para esta funcionalidad por simplicidad se ha decidido que se pueda listar únicamente por el DNI. En este caso si podemos finalizar la conexión a diferencia del anterior.</p>
<p>Una vez revisada la parte del servidor procedemos con la relativa al cliente. En primer lugar, la clase personalizada para poder emitir un evento personalizado para manejar múltiples eventos data, emitiendo un evento <code>response</code>:</p>
<pre><code class="language-ts"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-8">class</span><span class="hl-1"> </span><span class="hl-9">MessageEventEmitterClient</span><span class="hl-1"> </span><span class="hl-8">extends</span><span class="hl-1"> </span><span class="hl-9">EventEmitter</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">constructor</span><span class="hl-1">(</span><span class="hl-8">private</span><span class="hl-1"> </span><span class="hl-2">connection</span><span class="hl-1">: </span><span class="hl-9">net</span><span class="hl-1">.</span><span class="hl-9">Socket</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-8">super</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-5">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">connection</span><span class="hl-1">.</span><span class="hl-10">on</span><span class="hl-1">(</span><span class="hl-5">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">dataChunk</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">wholeData</span><span class="hl-1"> += </span><span class="hl-2">dataChunk</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">indexOf</span><span class="hl-1">(</span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">while</span><span class="hl-1"> (</span><span class="hl-2">messageLimit</span><span class="hl-1"> !== -</span><span class="hl-6">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-7">message</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">substring</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-2">messageLimit</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">wholeData</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">substring</span><span class="hl-1">(</span><span class="hl-2">messageLimit</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-8">this</span><span class="hl-1">.</span><span class="hl-10">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;response&#39;</span><span class="hl-1">, </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">));</span><br/><span class="hl-1">        </span><span class="hl-2">messageLimit</span><span class="hl-1"> = </span><span class="hl-2">wholeData</span><span class="hl-1">.</span><span class="hl-10">indexOf</span><span class="hl-1">(</span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-8">get</span><span class="hl-1"> </span><span class="hl-10">getConnection</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-8">this</span><span class="hl-1">.</span><span class="hl-2">connection</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Nótese que en la clase se ha añadido un método get connection, para poder añadir eventos al socket de la conexión, pues no se quería tener todo en el constructor.</p>
<p>Si nos centramos en el cliente, solo quiero aclarrar que se inicializar un cliente, se recoge el input mediante el uso de xargs, y se modifica una variable global, conocida como message. Una vez recogido el input, se inicializa el servidor, y a continuación se define la acción que se realizará tras conectarse al servidor (emitir el mensaje).</p>
<pre><code class="language-ts"><span class="hl-8">function</span><span class="hl-1"> </span><span class="hl-10">initializeServer</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-10">MessageEventEmitterClient</span><span class="hl-1">(</span><span class="hl-2">net</span><span class="hl-1">.</span><span class="hl-10">connect</span><span class="hl-1">({ </span><span class="hl-2">port:</span><span class="hl-1"> </span><span class="hl-6">8080</span><span class="hl-1"> }));</span><br/><br/><span class="hl-1">  </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-10">on</span><span class="hl-1">(</span><span class="hl-5">&#39;response&#39;</span><span class="hl-1">, (</span><span class="hl-2">data</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">switch</span><span class="hl-1"> (</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">statusCode</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-6">0</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">getConnection</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-6">200</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">generator</span><span class="hl-1">: </span><span class="hl-9">CardCreator</span><span class="hl-1">;</span><br/><span class="hl-1">          </span><span class="hl-4">switch</span><span class="hl-1"> (</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;creature&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-10">CreatureCardCreator</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">id_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">name_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">mana_cost_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">color_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">COLOR</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">TYPE</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">rarity_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">RARITY</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">rules_text_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">market_value_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">power_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">toughness_</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;planeswalker&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-10">PlanesWalkerCardCreator</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">id_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">name_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">mana_cost_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">color_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">COLOR</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">TYPE</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">rarity_</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">RARITY</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">rules_text_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">market_value_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">loyalty_marks_</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-4">default</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-2">generator</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-10">CardCreator</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">id_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">name_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">mana_cost_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">color_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">type_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">rarity_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">rules_text_</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">.</span><span class="hl-2">market_value_</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-2">generator</span><span class="hl-1">.</span><span class="hl-10">createCard</span><span class="hl-1">().</span><span class="hl-10">toString</span><span class="hl-1">() + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-6">201</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-10">green</span><span class="hl-1">(</span><span class="hl-5">`[✔] </span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">dataObj</span><span class="hl-8">}</span><span class="hl-5">`</span><span class="hl-1">));</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">default</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-2">chalk</span><span class="hl-1">.</span><span class="hl-10">red</span><span class="hl-1">(</span><span class="hl-5">`[❌] ERROR </span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">statusCode</span><span class="hl-8">}</span><span class="hl-5">: </span><span class="hl-8">${</span><span class="hl-2">data</span><span class="hl-12">.</span><span class="hl-2">dataObj</span><span class="hl-8">}</span><span class="hl-5">`</span><span class="hl-1">));</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">getConnection</span><span class="hl-1">.</span><span class="hl-10">on</span><span class="hl-1">(</span><span class="hl-5">&#39;connect&#39;</span><span class="hl-1">, () </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// console.log(message);</span><br/><span class="hl-1">    </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">getConnection</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">getConnection</span><span class="hl-1">.</span><span class="hl-10">on</span><span class="hl-1">(</span><span class="hl-5">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">&#39;MIAU!, Server closed connection&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Estas líneas son las verdaderamente importantes. Aclarar que si se recibe un código de estado 0, finalizaremos la conexión por parte del cliente. Si se recibe un sc de 200, transformaremos el objeto en su respectiva representación en carta, con el objetivo de poder usar el método toStringg y así el paquete chalk. Si se recibe un 201 se considerará que todo ha ido bien. Si ningún código de estado coincide. Se considerará un error.</p>
<pre><code class="language-ts"><span class="hl-1">  </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">getConnection</span><span class="hl-1">.</span><span class="hl-10">on</span><span class="hl-1">(</span><span class="hl-5">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Server closed connection&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span>
</code><button>Copy</button></pre>
<p>Finalmente se define el manejador del evento end para cuando se cierra la conexión.</p>
<a id="md:modificación" class="tsd-anchor"></a><h2><a href="#md:modificación">Modificación</a></h2><p>Para la modificación se ha solicitado que dos de las funciones de la práctica 9 se implementasen mediante el uso de funciones asíncronas que empleen callbacks. Para el estudio de la modificación se reimplementó el servidor de esta práctica para que hiciese uso pleno del patrón callback, obteniendo así un código más limpio. Los archivos del servidor nuevo, se encuentran en la carpeta de modificación. Se comentará por encima el nuevo enfoque que se le quiso dar:</p>
<p>El servidor ahora al tener callbacks, se ha empleado el siguiente tipo de manejador:</p>
<pre><code class="language-ts"><span class="hl-1">  </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-10">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Add action&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">ServerFunctionality</span><span class="hl-1">.</span><span class="hl-10">addFunctionality</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1"> ?? </span><span class="hl-2">data</span><span class="hl-1">!);</span><br/><span class="hl-1">      </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  </span><span class="hl-4">break</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>El único manejador distinto resulta el del list, pues se emite el statusCode a 0 para indicar al cliente el final de la conexión.</p>
<pre><code class="language-ts"><span class="hl-1">  </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-2">ServerFunctionality</span><span class="hl-1">.</span><span class="hl-10">listFunctionality</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-2">err</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">end</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">      } </span><br/><span class="hl-1">      </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">parsedData</span><span class="hl-1"> = </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">!);</span><br/><span class="hl-1">      </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">parsedData</span><span class="hl-1">.</span><span class="hl-2">statusCode</span><span class="hl-1"> === </span><span class="hl-6">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({</span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">0</span><span class="hl-1">}) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }	</span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">socket</span><span class="hl-1">.</span><span class="hl-10">write</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({</span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">200</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">parse</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">!).</span><span class="hl-2">dataObj</span><span class="hl-1">}) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    </span><span class="hl-4">break</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>El código de las funcionalidades ubicadas en el archivo <code>ServerFunctionality.ts</code>, conincide con lo ya mostrado, sino que se ha implementado el patrón callback, un ejemplo de implementación es el siguiente:</p>
<pre><code class="language-ts"><span class="hl-1">  </span><span class="hl-2">static</span><span class="hl-1"> </span><span class="hl-10">addFunctionality</span><span class="hl-1">(</span><span class="hl-2">dataInput</span><span class="hl-1">: </span><span class="hl-2">requestMessage</span><span class="hl-1">, </span><span class="hl-2">callback</span><span class="hl-1">: (</span><span class="hl-2">error</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1"> | </span><span class="hl-9">undefined</span><span class="hl-1">, </span><span class="hl-2">data</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1"> | </span><span class="hl-9">undefined</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> </span><span class="hl-8">void</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-2">card</span><span class="hl-1">: </span><span class="hl-9">Card</span><span class="hl-1"> = </span><span class="hl-8">this</span><span class="hl-1">.</span><span class="hl-10">parseCard</span><span class="hl-1">(</span><span class="hl-2">dataInput</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">stat</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">dataInput</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">card</span><span class="hl-12">.</span><span class="hl-2">id</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">if</span><span class="hl-1"> (!</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">callback</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file already exists!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">, </span><span class="hl-8">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">return</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-10">writeFile</span><span class="hl-1">(</span><span class="hl-5">`./Database/</span><span class="hl-8">${</span><span class="hl-2">dataInput</span><span class="hl-12">.</span><span class="hl-2">user</span><span class="hl-12">.</span><span class="hl-10">toLowerCase</span><span class="hl-12">().</span><span class="hl-10">replace</span><span class="hl-12">(</span><span class="hl-13">/\s/</span><span class="hl-8">g</span><span class="hl-12">, </span><span class="hl-5">&#39;_&#39;</span><span class="hl-12">)</span><span class="hl-8">}</span><span class="hl-5">/</span><span class="hl-8">${</span><span class="hl-2">card</span><span class="hl-12">.</span><span class="hl-2">id</span><span class="hl-8">}</span><span class="hl-5">.json`</span><span class="hl-1">, </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">(</span><span class="hl-2">dataInput</span><span class="hl-1">.</span><span class="hl-2">dataObj</span><span class="hl-1">, </span><span class="hl-8">null</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">), (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-10">callback</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;Error while writing the file&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">, </span><span class="hl-8">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-10">callback</span><span class="hl-1">(</span><span class="hl-8">undefined</span><span class="hl-1">, </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-10">stringify</span><span class="hl-1">({ </span><span class="hl-2">statusCode:</span><span class="hl-1"> </span><span class="hl-6">201</span><span class="hl-1">, </span><span class="hl-2">dataObj:</span><span class="hl-1"> </span><span class="hl-5">&#39;The file was saved successfully!&#39;</span><span class="hl-1"> }) + </span><span class="hl-5">&#39;</span><span class="hl-11">\n</span><span class="hl-5">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span>
</code><button>Copy</button></pre>
<p>Nótese el undefined para los errores, cuando se ha satisfecho la operación, y en el data para cuando suceden errores.</p>
<a id="md:4-conclusiones" class="tsd-anchor"></a><h1><a href="#md:4-conclusiones">4. Conclusiones</a></h1><p>Tras la realización de la práctica se ha comprendido perfectamente el funcionamiento del paquete xargs y chalk. Además de aprender el manejo de la API asícrona de node File System. Además de aumentar el conocimiento acerca del manejo de servidores, uso del módulo net de nodejs.</p>
<a id="md:5-referencias" class="tsd-anchor"></a><h1><a href="#md:5-referencias">5. Referencias</a></h1><ul>
<li><a href="https://nodejs.org/api/fs.html">Documentación del módulo FileSystem de Node</a></li>
<li><a href="https://www.youtube.com/watch?v=8JYBwCaZviE">Vídeo acerca del FileSystem de Node</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:índice"><span>Índice</span></a><a href="#md:1-📚-introducción-📚"><span>1. 📚 <wbr/>Introducción 📚</span></a><a href="#md:2-🧠-trabajo-previo-🧠"><span>2. 🧠 <wbr/>Trabajo previo 🧠</span></a><a href="#md:github-actions"><span>Git<wbr/>Hub <wbr/>Actions</span></a><a href="#md:integración-de-coveralls-en-github-action"><span>Integración de <wbr/>Coveralls en <wbr/>Git<wbr/>Hub action</span></a><a href="#md:integración-de-sonarcloud-en-github-action"><span>Integración de <wbr/>Sonar<wbr/>Cloud en <wbr/>Git<wbr/>Hub action</span></a><a href="#md:3-🖥️-desarrollo-de-la-práctica-🖥️"><span>3. 🖥️ <wbr/>Desarrollo de la práctica 🖥️</span></a><ul><li><a href="#md:modificación"><span>Modificación</span></a></li></ul><a href="#md:4-conclusiones"><span>4. <wbr/>Conclusiones</span></a><a href="#md:5-referencias"><span>5. <wbr/>Referencias</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>modi10</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>